Key Changes Made
✅ 1. Windows 11 Detection

Checks if system is already Windows 11 (Build 22000+)
Exits immediately with success code if already upgraded
Saves time and prevents unnecessary operations

✅ 2. Local ISO Copy (Network Performance Optimization)

Copies ISO from network share to C:\Temp\Win11.iso
Checks if ISO already exists locally before copying
Validates file sizes match between source and destination
Skips copy if local ISO is identical to network source
Much faster than streaming during setup

✅ 3. Updated Parameters
powershell-NetworkISOPath   # Your network share location
-LocalISOPath     # Where to copy locally (default: C:\Temp\Win11.iso)
-KeepInstallFiles # Keep ISO after upgrade starts
Setup Instructions
1. Update Network Path
Edit line 4 in the script to point to your ISO:
powershell[string]$NetworkISOPath = "\\your-fileserver\deployment\Windows11_23H2_x64.iso"
2. Deploy to Target Machines
Option A - Remote Execution:
powershell# Single machine
Invoke-Command -ComputerName TARGET-PC -FilePath .\Win11Upgrade.ps1 -ArgumentList @{NetworkISOPath="\\server\share\Win11.iso"}

# Multiple machines from file
$computers = Get-Content .\computers.txt
foreach ($pc in $computers) {
    Invoke-Command -ComputerName $pc -FilePath .\Win11Upgrade.ps1 -AsJob
}
Option B - PSExec:
powershellpsexec @computers.txt -s -d powershell.exe -ExecutionPolicy Bypass -File "\\server\scripts\Win11Upgrade.ps1"
Option C - GPO Startup Script:
Computer Configuration → Windows Settings → Scripts → Startup
Add: \\server\scripts\Win11Upgrade.ps1
Exit Codes Reference
CodeMeaning0Success (upgraded or already Win11)1Not running as Administrator2System requirements not met3Registry block removal failed4ISO copy to local disk failed5ISO mount/setup.exe not found6Upgrade start failed99Unexpected error
Execution Flow

✅ Check if already Windows 11 → Exit if yes
✅ Check admin privileges
✅ Validate system requirements (TPM 2.0, RAM, disk space)
✅ Remove registry blocks
✅ Copy ISO from network to C:\Temp (or use existing)
✅ Mount ISO locally
✅ Start unattended upgrade
✅ System reboots automatically

Monitoring Progress
Check logs on each machine:
powershellGet-Content "C:\Windows\Temp\Win11Upgrade.log" -Tail 20
Or remotely:
powershellInvoke-Command -ComputerName PC01 -ScriptBlock { Get-Content "C:\Windows\Temp\Win11Upgrade.log" -Tail 20 }
Benefits of This Approach

Network efficiency: ISO copied once, then used locally
Idempotent: Safe to run multiple times (skips if already Win11)
Resumable: Re-running uses existing local ISO if present
Bandwidth savings: 100 machines = 1 copy per machine vs 100 concurrent streams

The script is production-ready! Just update the $NetworkISOPath parameter and deploy

-----------------v1 notes below. v2 above----------------

Key Features
✅ Prerequisite checks: TPM 2.0, Secure Boot, RAM, disk space
✅ Registry block removal: Clears upgrade restrictions
✅ Unattended installation: No user interaction required
✅ Comprehensive logging: Tracks all steps
✅ Error handling: Exit codes for monitoring
Important Setup Requirements
1. Host the Windows 11 ISO
The script expects a Windows 11 ISO. You have two options:
Option A - Network Share (Recommended for enterprise):
powershell# Update line 95 in script to:
$ISOPath = "\\your-server\deployment\Windows11_23H2_x64.iso"
Option B - Download ISO manually:

Download from Microsoft: https://www.microsoft.com/software-download/windows11
Place at: C:\Windows\Temp\Win11.iso

2. Disk Space Requirements

Minimum free space: 25 GB
Recommended: 30-35 GB for safety

3. Remote Deployment Methods
Via PSExec:
powershellpsexec \\TARGET-PC -s powershell.exe -ExecutionPolicy Bypass -File "\\server\scripts\Win11Upgrade.ps1"
Via Group Policy / Startup Script:

Deploy as computer startup script
Runs with SYSTEM privileges

Via RMM Tool (e.g., ConnectWise, Ninja, Datto):

Upload script to your RMM
Deploy to target device collection

4. Test First!
powershell# Test run with verbose logging
.\Win11Upgrade.ps1 -Verbose
Exit Codes

0: Success
1: Not running as admin
2: System requirements not met
3: Registry block removal failed
4: ISO not found
5: ISO mount failed
6: Upgrade start failed

Monitoring Progress
Check the log file: C:\Windows\Temp\Win11Upgrade.log

